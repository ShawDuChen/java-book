import{d as D,N as M,r as C,A as O,o as V,w as k,u as e,c as F,b as a,e as s,v as _,t as h,Q as P,G as R,y as x,z as u,f as U,g as j,m as c,R as G,j as p,S as I,n as b,k as f,T as L,p as Q,U as q}from"./index-CTdGs5XT.js";import{u as H,f as J,_ as K,d as W}from"./product-card.vue_vue_type_script_setup_true_lang-w8wZwdhf.js";import{c as X}from"./shopOrder-D9heZ3cw.js";import{u as Y}from"./index-7XaKpovQ.js";import{l as Z}from"./lodash-BNYBvJY_.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"selection"},ae={class:"info"},ne={class:"price"},oe=D({__name:"index",setup(se){const{bool:E,toggle:l}=Y(),g=M(),m=C([]),T=R(),i=async()=>{const t=await J(g.id);m.value=t.list||[]},r=C([]),B=t=>{r.value=t},w=O(()=>r.value.reduce((t,n)=>{var d;return t+n.count*(((d=n.product)==null?void 0:d.price)||0)},0).toFixed(2)),S=t=>{x.confirm("是否移除该商品？","提示",{type:"warning"}).then(()=>{l(),W(t.id).then(()=>{u.success("移除成功~"),i()}).finally(()=>l())}).catch(()=>{u.info("取消操作~")})},$=t=>{var n;return(t.count*(((n=t.product)==null?void 0:n.price)||0)).toFixed(2)},z=()=>{x.confirm("确认创建订单，并打开支付窗口吗？","提示",{type:"warning"}).then(()=>{N()}).catch(()=>{u.info("已取消创建订单~")})},N=()=>{const t=r.value.map(n=>n.id);l(),X(t,g.id).then(n=>{u.success("创建订单成功，为您打开付款页面~"),i(),A(n.data)}).finally(()=>l())},A=t=>{T.push(`/c/pay?id=${t.id}`)},v=Z.debounce((t,n)=>{l(),H({...t,count:t.count+n}).then(()=>{i()}).finally(()=>l())},200);return V(()=>{i()}),(t,n)=>{const d=U("loading");return k((j(),F("div",null,[a(e(Q),{data:m.value,onSelectionChange:B},{default:s(()=>[a(e(c),{type:"selection",align:"center"}),a(e(c),{prop:"product",label:"商品详情"},{default:s(({row:o})=>[a(K,{data:o.product,onlyshow:!0},null,8,["data"])]),_:1}),a(e(c),{prop:"createdAt",label:"加入购物车时间",align:"center"}),a(e(c),{prop:"count",label:"数量",align:"center",width:"100px"},{default:s(({row:o})=>[a(e(G),null,{default:s(()=>[a(e(p),{circle:"",icon:e(I),size:"small",disabled:o.count===1,onClick:y=>e(v)(o,-1)},null,8,["icon","disabled","onClick"]),a(e(b),{type:"danger",effect:"dark"},{default:s(()=>[f(h(o.count),1)]),_:2},1024),a(e(p),{circle:"",icon:e(L),size:"small",onClick:y=>e(v)(o,1)},null,8,["icon","onClick"])]),_:2},1024)]),_:1}),a(e(c),{porp:"total",label:"总价",align:"center"},{default:s(({row:o})=>[a(e(b),{type:"danger",effect:"dark"},{default:s(()=>[f("￥"+h($(o)),1)]),_:2},1024)]),_:1}),a(e(c),{prop:"action",label:"操作",width:"80px",align:"center"},{default:s(({row:o})=>[a(e(p),{type:"danger",link:"",onClick:y=>S(o)},{default:s(()=>[f("移除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),k(_("div",te,[_("div",ae,[_("h1",ne,"￥ "+h(w.value),1),a(e(p),{type:"danger",size:"large",icon:e(q),onClick:z},{default:s(()=>[f("提交订单")]),_:1},8,["icon"])])],512),[[P,r.value.length]])])),[[d,e(E)]])}}}),pe=ee(oe,[["__scopeId","data-v-4f553eda"]]);export{pe as default};

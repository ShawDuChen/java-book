import{d as D,I as M,a as y,B as N,o as P,w as x,u as e,c as V,e as a,f as s,x as _,t as h,P as F,O as I,z as k,A as u,g as R,h as q,n as c,Q as L,k as p,R as Q,p as b,l as f,S as U,q as j,T as G}from"./index-a7oZ5LST.js";import{u as H,f as J,_ as K,d as W}from"./product-card.vue_vue_type_script_setup_true_lang-D3A3teZX.js";import{c as X}from"./shopOrder-DPpOEaSa.js";import{u as Y}from"./index-BJJCNVtC.js";import{l as Z}from"./lodash-DseUsP9g.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"selection"},ae={class:"info"},ne={class:"price"},oe=D({__name:"index",setup(se){const{bool:E,toggle:l}=Y(),g=M(),m=y([]),B=I(),i=async()=>{const t=await J(g.id);m.value=t.list||[]},r=y([]),T=t=>{r.value=t},w=N(()=>r.value.reduce((t,n)=>{var d;return t+n.count*(((d=n.product)==null?void 0:d.price)||0)},0).toFixed(2)),S=t=>{k.confirm("是否移除该商品？","提示",{type:"warning"}).then(()=>{l(),W(t.id).then(()=>{u.success("移除成功~"),i()}).finally(()=>l())}).catch(()=>{u.info("取消操作~")})},$=t=>{var n;return(t.count*(((n=t.product)==null?void 0:n.price)||0)).toFixed(2)},z=()=>{k.confirm("确认创建订单，并打开支付窗口吗？","提示",{type:"warning"}).then(()=>{O()}).catch(()=>{u.info("已取消创建订单~")})},O=()=>{const t=r.value.map(n=>n.id);l(),X(t,g.id).then(n=>{u.success("创建订单成功，为您打开付款页面~"),i(),A(n.data)}).finally(()=>l())},A=t=>{B.push(`/c/pay?id=${t.id}`)},v=Z.debounce((t,n)=>{l(),H({...t,count:t.count+n}).then(()=>{i()}).finally(()=>l())},200);return P(()=>{i()}),(t,n)=>{const d=R("loading");return x((q(),V("div",null,[a(e(j),{data:m.value,onSelectionChange:T},{default:s(()=>[a(e(c),{type:"selection",align:"center"}),a(e(c),{prop:"product",label:"商品详情"},{default:s(({row:o})=>[a(K,{data:o.product,onlyshow:!0},null,8,["data"])]),_:1}),a(e(c),{prop:"createdAt",label:"加入购物车时间",align:"center"}),a(e(c),{prop:"count",label:"数量",align:"center",width:"100px"},{default:s(({row:o})=>[a(e(L),null,{default:s(()=>[a(e(p),{circle:"",icon:e(Q),size:"small",disabled:o.count===1,onClick:C=>e(v)(o,-1)},null,8,["icon","disabled","onClick"]),a(e(b),{type:"danger",effect:"dark"},{default:s(()=>[f(h(o.count),1)]),_:2},1024),a(e(p),{circle:"",icon:e(U),size:"small",onClick:C=>e(v)(o,1)},null,8,["icon","onClick"])]),_:2},1024)]),_:1}),a(e(c),{porp:"total",label:"总价",align:"center"},{default:s(({row:o})=>[a(e(b),{type:"danger",effect:"dark"},{default:s(()=>[f("￥"+h($(o)),1)]),_:2},1024)]),_:1}),a(e(c),{prop:"action",label:"操作",width:"80px",align:"center"},{default:s(({row:o})=>[a(e(p),{type:"danger",link:"",onClick:C=>S(o)},{default:s(()=>[f("移除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),x(_("div",te,[_("div",ae,[_("h1",ne,"￥ "+h(w.value),1),a(e(p),{type:"danger",size:"large",icon:e(G),onClick:z},{default:s(()=>[f("提交订单")]),_:1},8,["icon"])])],512),[[F,r.value.length]])])),[[d,e(E)]])}}}),pe=ee(oe,[["__scopeId","data-v-4f553eda"]]);export{pe as default};
